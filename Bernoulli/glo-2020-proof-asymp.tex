%%%% Proof of Hoeffding inequality 


\section{Proof of Theorem~\ref{cor:hoeffding:tau:marginal}}
\label{sec:proof:prop:hoeffding:tau:marginal}

As explained in Section~\ref{sec:convergence:pm:PaRIS}, 
Theorem~\ref{cor:hoeffding:tau:marginal} follows as an immediate corollary of the following more general result, to whose proof we devote this section. 

\begin{proposition}
\label{prop:hoeffding:tau:marginal}
Assume \hypref[assum:biased:estimate]{assum:bound:filter:pseudomarginal}. Then for all $n \in \nset$, $h_n \in \bmaf{\Xfd^n}$, $(f_n, \ftd{n}) \in \bmf{\Xfd_n}^2$, and $\K \in \nsetpos$ there exist $(c_n, d_n) \in \rsetpos^2$ such that for all $\N \in \nsetpos$ and $\delta > 0$,
\begin{itemize}
\item[(i)] 
$ \displaystyle
\pP\left(\left| \frac{1}{\N} \sum_{i = 1}^\N \ewght{n}{i} \{\tstat[i]{n} f_n(\epart{n}{i}) + \ftd{n}(\epart{n}{i})\} - \frac{\postmod{n - 1} \ukmod{n - 1} ( \tstatmod{n} h_n f_n + \tilde{f}_n )}{\postmod{n - 1} \adjfuncforward{n - 1}} \right| \geq \delta \right) \leq c_n \exp \left( - d_n \N \delta^2 \right),
$
\item[(ii)] 
$ \displaystyle
\pP\left(\left| \sum_{i = 1}^\N \frac{\ewght{n}{i}}{\sumwght{n}} \{\tstat[i]{n} f_n(\epart{n}{i}) + \tilde{f}_n(\epart{n}{i})\} - \postmod{n} ( \tstatmod{n} h_n f_n + \tilde{f}_n ) \right| \geq \delta \right) \leq c_n \exp \left( - d_n \N \delta^2 \right).
$
\end{itemize}
\end{proposition}

Note that letting $f_n \equiv 1$ and $\ftd{n} \equiv 0$ in (ii) yields immediately Theorem~\ref{cor:hoeffding:tau:marginal}. 

We preface the proof of Proposition~\ref{prop:hoeffding:tau:marginal} by a technical lemma, generalising \cite[Lemma~12]{olsson:westerborn:2014b} and \cite[Lemma~2]{gloaguen2018online}, which will be instrumental in the following. For all $n \in \nset$, define the following $\sigma$-fields:
\begin{align*}
\calF{n}{\N} &\eqdef \sigma \{ (\epart{m}{i}, \ewght{m}{i}, \tstat[i]{m}) : i \in \intvect{1}{\N}, m \in \intvect{0}{n} \}, \\
\calG{n + 1}{\N} &\eqdef \sigma \{(\epart{n + 1}{i}, \ind{n + 1}{i}) : i \in \intvect{1}{\N} \} \vee \calF{n}{\N}. 
\end{align*}

\begin{lemma}
\label{lem:expectation:incremental:marginal}
Assume \hypref[assum:biased:estimate]{assum:bound:filter:pseudomarginal}. For all $n \in \nset$, $(f_{n + 1}, \ftd{n + 1}) \in \bmf{\Xfd_{n + 1}}^2$, and $(\N, \K) \in \nsetpos^2$, the random variables $\ewght{n + 1}{i}\{\tstat[i]{n + 1} f_{n + 1}(\epart{n + 1}{i}) + \ftd{n + 1}(\epart{n + 1}{i})\}$, $i \in \intvect{1}{\N}$, are independent and identically distributed (i.i.d.) conditionally to $\calF{n}{\N}$. In addition, for all $i$,  
\begin{multline*}
\pE \left[\ewght{n + 1}{i}\{\tstat[i]{n + 1}f_{n + 1}(\epart{n + 1}{i}) + \ftd{n + 1}(\epart{n + 1}{i})\} \cond  \calF{n}{\N} \right] \\
 = (\post[\N]{n} \adjfuncforward{n})^{-1} 
 \sum_{j = 1}^\N \frac{\ewght{n}{j}}{\sumwght{n}}
\{ \tstat[j]{n} \ukmod{n} f_{n + 1}(\epart{n}{j}) + \ukmod{n}(\addf{n} f_{n + 1} + \ftd{n + 1})(\epart{n}{j})\}.
\end{multline*}
\end{lemma}

%%%%% Proof expectation i.i.d. variables 

\begin{proof}
Independence and equal distribution is immediate by construction of Algorithm~\ref{alg:pm:PaRIS}. Moreover, note that
\begin{equation} \label{eq:expected:weight:given:G}
\pE \left[\ewght{n + 1}{1} \cond \calG{n + 1}{\N} \right] = \int \wgtfunc{n}(\epart{n}{\ind{n + 1}{1}}, \epart{n + 1}{1}, z) \, \ukdist{n}(\epart{n}{\ind{n + 1}{1}}, \epart{n + 1}{1}, \rmd z) = \wgtfuncmod{n}(\epart{n}{\ind{n + 1}{1}}, \epart{n + 1}{1}), 
\end{equation}
where $\wgtfunc{n}$ and $\wgtfuncmod{n}$ are defined in \hypref{assum:bound:filter:pseudomarginal}(ii), and 
$$
\pE \left[\tstat[1]{n + 1} \cond \calG{n + 1}{\N} \right] = \sum_{i = 1}^\N \frac{\ewght{n}{i} \udmod{n} (\epart{n}{i}, \epart{n + 1}{1})}{\sum_{i' = 1}^{\N} \ewght{n}{i'} \udmod{n}(\epart{n}{i'}, \epart{n + 1}{1})} \left(\tstat[i]{n} + \addf{n}(\epart{n}{i}, \epart{n + 1}{1}) \right). 
$$
Then, since $\tstat[1]{n + 1}$ and  $\ewghthat{n + 1}{1}$ are conditionally independent given $\calG{n + 1}{\N}$,
\begin{align*}
\lefteqn{\pE \left[\ewghthat{n + 1}{1} \{ \tstat[1]{n + 1} f_{n + 1}(\epart{n + 1}{1}) + \ftd{n + 1}(\epart{n + 1}{1}) \} \cond \calF{n}{\N}\right]} \hspace{10mm} \nonumber \\
&= \pE \left[\pE \left[ \ewghthat{n + 1}{1} \cond \calG{n + 1}{\N} \right] \pE \left[\tstat[1]{n + 1} \cond \calG{n + 1}{N}\right] f_{n + 1}(\epart{n + 1}{1}) \cond \calF{n}{\N} \right] \nonumber \\
&\hspace{4cm} + \pE \left[ \pE \left[ \ewghthat{n + 1}{1} \cond \calG{n + 1}{\N} \right] \ftd{n + 1}(\epart{n + 1}{1}) \cond \calF{n}{N} \right] \nonumber \\
&= \pE \left[ \wgtfuncmod{n}(\epart{n}{\ind{n + 1}{1}}, \epart{n + 1}{1}) \sum_{i = 1}^\N \frac{\ewght{n}{i} \udmod{n} (\epart{n}{i}, \epart{n + 1}{1})}{\sum_{i' = 1}^{\N} \ewght{n}{i'} \udmod{n} (\epart{n}{i'}, \epart{n + 1}{1})} \left(\tstat[i]{n} + \addf{n}(\epart{n}{i}, \epart{n + 1}{1}) \right) f_{n + 1}(\epart{n + 1}{1}) \cond \calF{n}{\N} \right] \nonumber \\
&\hspace{4cm} + \pE \left[\wgtfuncmod{n}(\epart{n}{\ind{n + 1}{1}}, \epart{n + 1}{1}) \ftd{n + 1}(\epart{n + 1}{1}) \cond \calF{n}{\N} \right]. \label{eq:exp:decomposition}
\end{align*}
Now, we may complete the proof by noting that, by \eqref{eq:cond:instrumental:mixture},  
\begin{align*} 
\lefteqn{\pE \left[ \wgtfuncmod{n}(\epart{n}{\ind{n + 1}{1}}, \epart{n + 1}{1}) \sum_{i = 1}^\N \frac{\ewghthat{n}{i} \udmod{n} (\epart{n}{i}, \epart{n + 1}{1})}{\sum_{i' = 1}^{\N} \ewghthat{n}{i'} \udmod{n} (\epart{n}{i'}, \epart{n + 1}{1})} \left(\tstat[i]{n} + \addf{n}(\epart{n}{i}, \epart{n + 1}{1}) \right) f_{n + 1}(\epart{n + 1}{1}) \cond \calF{n}{\N} \right]} \hspace{10mm} \\
&= (\post[\N]{n} \adjfuncforward{n})^{-1} \sum_{j = 1}^\N \frac{\ewght{n}{j}}{\sumwght{n}} \int \udmod{n}(\epart{n}{j}, x) \mu(\rmd x) \sum_{i = 1}^\N \frac{\ewghthat{n}{i} \udmod{n} (\epart{n}{i}, x)}{\sum_{i' = 1}^\N \ewghthat{n}{i'} \udmod{n} (\epart{n}{i'}, x)} \left(\tstat[i]{n} + \addf{n}(\epart{n}{i}, x) \right) f_{n + 1}(x) \\
&= (\post[\N]{n} \adjfuncforward{n})^{-1} \sum_{i = 1}^\N \frac{\ewght{n}{i}}{\sumwght{n}} \{ \tstat[i]{n} \ukmod{n} f_{n + 1}(\epart{n}{i}) + \ukmod{n}(\addf{n} f_{n + 1})(\epart{n}{i}) \}
\end{align*}
and, similarly, 
\begin{equation*}
 \pE \left[\wgtfuncmod{n}(\epart{n}{\ind{n + 1}{1}}, \epart{n + 1}{1}) \ftd{n + 1}(\epart{n + 1}{1}) \cond \calF{n}{\N} \right] = (\post[\N]{n} \adjfuncforward{n})^{-1} \sum_{i = 1}^\N \frac{\ewght{n}{i}}{\sumwght{n}} \ukmod{n} \ftd{n + 1}(\epart{n}{i}). 
\end{equation*}
\end{proof}

\begin{proof}[Proof of Proposition~\ref{prop:hoeffding:tau:marginal}]
We establish (i) by induction over $n$. Write, using Lemma~\ref{lem:expectation:incremental:marginal},
\begin{multline} \label{eq:hoeffding:decomp}
\frac{1}{\N} \sum_{i = 1}^\N \ewght{n + 1}{i} \{\tstat[i]{n + 1} f_{n + 1}(\epart{n + 1}{i}) + \ftd{n + 1}(\epart{n + 1}{i})\} - \frac{\postmod{n} \ukmod{n} \{ \tstatmod{n + 1} h_{n + 1} f_{n + 1} + \ftd{n + 1} \}}{\postmod{n} \adjfuncforward{n}}  \\
= \frac{1}{\N} \sum_{i = 1}^\N \ewght{n + 1}{i} \{\tstat[i]{n + 1} f_{n + 1}(\epart{n + 1}{i}) + \ftd{n + 1}(\epart{n + 1}{i})\} - \pE \left[ \ewght{n + 1}{1} \{\tstat[1]{n + 1} f_{n + 1}(\epart{n + 1}{1}) + \ftd{n + 1}(\epart{n + 1}{1})\} \cond \calF{n}{\N} \right] \\
+ \sum_{j = 1}^\N 
\frac{\ewght{n}{j} \adjfuncforward{n}(\epart{n}{j})}{\sum_{j' = 1}^\N \ewght{n}{j'} \adjfuncforward{n}(\epart{n}{j'})} \{ \tstat[j]{n} \prop{n} (\wgtfuncmod{n} f_{n + 1})(\epart{n}{j}) + \prop{n}(\wgtfuncmod{n} \addf{n} f_{n + 1} + \wgtfuncmod{n} \ftd{n + 1})(\epart{n}{j})\} \\
- \frac{\postmod{n - 1} \ukmod{n - 1}\{\tstatmod{n} \ukmod{n} f_{n + 1} + \ukmod{n} (\addf{n} f_{n + 1} + \ftd{n + 1})\}}{\postmod{n - 1} \ukmod{n - 1} \adjfuncforward{n}}. 
\end{multline}
Since for all $i$, 
$$
|\ewght{n + 1}{i} \{\tstat[i]{n + 1} f_{n + 1}(\epart{n + 1}{i}) + \ftd{n + 1}(\epart{n + 1}{i})\}| \leq \| \wgtfunc{n} \|_\infty (\| h_{n + 1} \|_\infty \| f_{n + 1} \|_\infty + \| \ftd{n + 1} \|_\infty), 
$$
the Hoeffding inequality for conditional expectations provides constants $(d, \tilde{d}) \in \rsetpos^2$ such that for all $\delta > 0$, 
\begin{multline*}
\pP \left( \left| \frac{1}{\N} \sum_{i = 1}^\N \ewght{n + 1}{i} \{\tstat[i]{n + 1} f_{n + 1}(\epart{n + 1}{i}) + \ftd{n + 1}(\epart{n + 1}{i})\} \right. \right. \\
\left. \left.  - \pE \left[ \ewght{n + 1}{1} \{\tstat[1]{n + 1} f_{n + 1}(\epart{n + 1}{1}) + \ftd{n + 1}(\epart{n + 1}{1})\} \cond \calF{n}{\N} \right] \vphantom{\sum_{i = 1}^\N} \right| \geq \delta \right) \leq d \exp \left( - \tilde{d} N \delta^2 \right).  
\end{multline*}
In addition, since $\adjfuncforward{n}$, $\adjfuncforward{n} \prop{n} (\wgtfuncmod{n} f_{n + 1})$, and $\adjfuncforward{n} \prop{n}(\wgtfuncmod{n} \addf{n} f_{n + 1} + \wgtfuncmod{n} \ftd{n + 1})$ all belong to $\bmf{\Xfd_n}$, there exist, by the induction hypothesis and \cite[Lemma~4]{douc:garivier:moulines:olsson:2010}, $(d', \tilde{d}') \in \rsetpos^2$ such that for all $\delta > 0$, 
\begin{multline*}
\pP \left( \left|  \sum_{j = 1}^\N 
\frac{\ewght{n}{j} \adjfuncforward{n}(\epart{n}{j})}{\sum_{j' = 1}^\N \ewght{n}{j'} \adjfuncforward{n}(\epart{n}{j'})} \{ \tstat[j]{n} \prop{n} (\wgtfuncmod{n} f_{n + 1})(\epart{n}{j}) + \prop{n}(\wgtfuncmod{n} \addf{n} f_{n + 1} + \wgtfuncmod{n} \ftd{n + 1})(\epart{n}{j})\} \right. \right. \\
\left. \left. - \frac{\postmod{n - 1} \ukmod{n - 1}\{\tstatmod{n} \ukmod{n} f_{n + 1} + \ukmod{n} (\addf{n} f_{n + 1} + \ftd{n + 1})\}}{\postmod{n - 1} \ukmod{n - 1} \adjfuncforward{n}} \right| \geq \delta \right) \leq d' \exp \left( - \tilde{d}' N \delta^2 \right).  
\end{multline*}
Combining the previous two inequalities completes the proof of (i) at time step $n + 1$. The base case $n = 1$ is established using again the decomposition \eqref{eq:hoeffding:decomp}, the standard Hoeffding inequality for independent and identically distributed variables, \cite[Lemma~4]{douc:garivier:moulines:olsson:2010}, and the fact that $h_0 \equiv 0$.   

Final, (ii) follows immediately from (i) and \cite[Lemma~4]{douc:garivier:moulines:olsson:2010}.
\end{proof} 

%%%% Proof of CLT 

\section{Proof of Theorem~\ref{cor:clt:pseudo:marginal:paris}}
\label{sec:proof:prop:clt:pseudo:marginal:paris}

We now turn our focus to the proof of Theorem~\ref{cor:clt:pseudo:marginal:paris}, which, just like Theorem~\ref{cor:hoeffding:tau:marginal}, will be established via the following more general result. 

\begin{theorem}
\label{prop:clt:pseudo:marginal:paris}
Assume~\hypref[assum:biased:estimate]{assum:bound:filter:pseudomarginal}. Then for all $n \in \nset$, $\K \in \nsetpos$, and $(f_n, \ftd{n}) \in \bmf{\Xfd_n}^2$,
$$
 \sqrt{\N} \left( \sum_{i = 1}^\N \frac{\ewght{n}{i}}{\sumwght{n}} \{\tstat[i]{n} f_n(\epart{n}{i}) + \ftd{n}(\epart{n}{i}) \} - \postmod{n}(\tstatmod{n} h_n f_n + \ftd{n}) \right) 
  \dlim \sigma_n(h_n, f_n, \ftd{n}) Z,
$$
where $Z$ is standard normally distributed and 
\begin{equation} \label{eq:non-recursive:as:var:affine}
\sigma^2_n (h_n, f_n, \ftd{n}) \eqdef \frac{\chi \{ \initwgtfunc
\retrokmodmodnorm_{0, n} (h_n f_n + \ftd{n}) \}^2}{(\chi \ukmod{0, n - 1} \1_{\Xset^n})^2} 
+ \sigma^2_n \langle (\wgtfuncmod{\ell})_{\ell = 0}^{n - 1} \rangle (h_n, f_n, \ftd{n}) 
+ \sigma^2_n \langle (\ukestvar{\ell})_{\ell = 0}^{n - 1} \rangle (h_n, f_n, \ftd{n}) 
\end{equation}
and
\begin{multline} \label{eq:partial:variance}
\sigma^2_n \langle (\varphi_\ell)_{\ell = 0}^{n - 1} \rangle (h_n, f_n, \ftd{n}) 
\eqdef \sum_{m = 0}^{n - 1} \frac{\postmod{m} \adjfuncforward{m} \postmod{m} \ukmod{m} \{ \varphi_m [\retrokmodmodnorm_{m + 1, n} (h_n f_n + \ftd{n})]^2
\}}{(\postmod{m} \ukmod{m, n - 1} \1_{\Xset_n})^2} \\
+ \sum_{m = 0}^{n - 1} \sum_{\ell = 0}^m \frac{\postmod{m} \adjfuncforward{m} \postmod{\ell} \ukmod{\ell} \{\bkmod{\ell}(\tstatmod{\ell} h_{\ell} + \addf{\ell} - \tstatmod{\ell + 1} h_{\ell +1})^2 \ukmod{\ell + 1, m}( \bkmod{m} \varphi_m [\ukmod{m + 1, n - 1} f_n]^2
)\}}{\K^{m - \ell + 1} (\postmod{\ell} \ukmod{\ell, m - 1} \1_{\Xset_m})(\postmod{m} \ukmod{m, n - 1} \1_{\Xset_n})^2}
\end{multline}
for any sequence $(\varphi_\ell)_{\ell \in \nset}$ of measurable functions $\varphi_n : \Xset_n \times \Xset_{n + 1} \to \rsetnn$. 
\end{theorem}

As previously, applying Theorem~\ref{prop:clt:pseudo:marginal:paris} with $f_n \equiv 1$ and $\ftd{n} \equiv 0$ yields immediately Theorem~\ref{cor:hoeffding:tau:marginal}. Before proving Theorem~\ref{prop:clt:pseudo:marginal:paris} we establish some preparatory lemmas, where the first is easily obtained by combining Lemma~\ref{lem:reversibility}(i) (applied to the skew modeled formed by $\chi$ and $(\ukmod{n})_{n \in \nset}$) and \eqref{eq:forward:smoothing}. 

\begin{lemma} \label{eq:critical:identity}
Assume \hypref{assum:biased:estimate}. Then for all $n \in \nset$ and $(f_{n + 1}, \ftd{n + 1}) \in \bmf{\Xfd_{n + 1}}^2$, 
$$
\postmod{n} \ukmod{n}(\tstatmod{n + 1} h_{n + 1} f_{n + 1} + \ftd{n + 1}) = \postmod{n}\{\tstatmod{n} \ukmod{n} f_{n + 1} + \ukmod{n} (\addf{n} f_{n + 1} + \ftd{n + 1})\}. 
$$
\end{lemma}

\begin{lemma}
\label{lem:hoeffding:tau:square}
Assume \hypref[assum:biased:estimate]{assum:bound:filter:pseudomarginal}. Then for all $n \in \nset$, $f \in \bmf{\Xfd_n}$, and $\K \in \nsetpos$, 
\[
\sum_{i = 1}^\N \frac{\ewght{n}{i}}{\sumwght{n}}(\tstat[i]{n})^2 f(\epart{n}{i}) \pplim \postmod{n}([\tstatmod{n} h_n]^2 f) + \eta_n f, 
\]
where the measures $(\eta_m)_{m \in \nsetpos}$ are defined recursively as 
\[
\eta_{m + 1} f = \K^{-1} \frac{\eta_m \ukmod{m} f +  \postmod{m} \ukmod{m} \{ \bkmod{m}(\tstatmod{m} h_m + \addf{m} - \tstatmod{m + 1} h_{m + 1})^2 f \}}{\postmod{m} \ukmod{m} \1_{\Xset_{m + 1}}}, \quad m \in \nset, 
\]
with $\eta_0 \equiv 0$. 
\end{lemma}

Following \cite[Lemma~13]{olsson:westerborn:2017}, the measures $(\eta_m)_{m \in \nsetpos}$ may be expressed non-recursively as
\begin{equation}
\label{eq:def:etak}
\eta_n f = \sum_{m = 0}^{n - 1} \K^{m - n} \frac{\postmod{m} \ukmod{m} \{ \bkmod{m}(\tstatmod{m} h_m + \addf{m} - \tstatmod{m + 1} h_{m + 1})^2 \ukmod{m + 1, n - 1} f \}}{\postmod{m} \ukmod{m, n - 1} \1_{\Xset_n}}.
\end{equation}

\begin{proof}[Proof of Lemma~\ref{lem:hoeffding:tau:square}]
We proceed by induction over $n$. The base case $n = 0$ is a trivial consequence of the fact that $\tstat{0} h_0 = 0$ and $\tstat[i]{0} = 0$ for all $i \in \intvect{1}{\N}$. Thus, we assume that the result holds true for some $n \in \nset$ and write
\[
\sum_{i=1}^\N \frac{\ewght{n+1}{i}}{\sumwght{n+1}}(\tstat[i]{n+1})^2 f(\epart{n+1}{i}) = \frac{a_\N}{b_\N},
\]
where 
$$
a_\N \eqdef \frac{1}{\N}\sum_{i=1}^N\ewght{n+1}{i}(\tstat[i]{n+1})^2 f(\epart{n+1}{i}), \quad b_\N \eqdef \frac{1}{\N} \sum_{i=1}^N \ewght{n+1}{i}
$$

We first establish the convergence in probability of $(a_\N)_{\N \in \nsetpos}$. Using again Hoeffding's inequality for conditional expectations and the fact that the variables $\ewght{n+1}{i}(\tstat[i]{n + 1})^2 f_{n + 1}(\epart{n + 1}{i})$, $i \in \intvect{1}{\N}$, are all bounded by $\| \wgtfunc{n} \|_\infty \| h_{n + 1} \|^2_\infty \| f_{n + 1}\|_\infty$ and conditionally i.i.d. given $\calF{n}{\N}$ for all $i$, we obtain for all $\epsilon > 0$,  
\[
\pP\left(\left| a_\N - \pE[a_\N \mid \calF{n}{\N}] \right| \geq \epsilon \right) \leq \exp \left( - \frac{2 \N \epsilon^2}{\| \wgtfunc{n} \|_\infty \| h_{n + 1} \|^2_\infty \| f_{n+1} \|_\infty} \right). 
\]
It is hence enough to consider the limit in probability of $\pE[a_\N \mid \calF{n}{\N}]$ as $\N$ tends to infinity. For this purpose, write, using \eqref{eq:expected:weight:given:G}, 
\begin{align*}
\pE[a_\N \mid \calF{n}{\N}] &= \pE \left[ \ewght{n + 1}{1}(\tstat[1]{n + 1})^2 f_{n+1}(\epart{n + 1}{1}) \mid  \calF{n}{\N} \right] \\ 
&= \pE\left[\wgtfuncmod{n}(\epart{n}{\ind{n + 1}{1}}, \epart{n + 1}{1}) \pE \left[(\tstat[1]{n + 1})^2 \cond \calG{n + 1}{\N}\right] f_{n + 1}(\epart{n + 1}{1}) \cond \calF{n}{\N} \right] \\
&= a_\N' + a_\N'',
\end{align*}
where
\begin{align*}
a_\N' &\eqdef \K^{-1}\pE\left[ \wgtfuncmod{n}(\epart{n}{\ind{n + 1}{1}}, \epart{n + 1}{1}) f_{n + 1}(\epart{n + 1}{1}) \pE \left[ \left( \tstat[J_{n + 1}^{(1,1)}]{n} + \addf{n}(\epart{n}{J_{n + 1}^{(1,1)}}, \epart{n + 1}{1}) \right)^2 \cond \calG{n + 1}{\N}\right] \cond \calF{n}{\N} \right], \\
a_\N'' &\eqdef (\K - 1)\K^{-1} \pE \left[ \wgtfuncmod{n}(\epart{n}{\ind{n + 1}{1}}, \epart{n + 1}{1}) f_{n + 1}(\epart{n + 1}{1}) \pE \left[\tstat[J_{n + 1}^{(1,1)}]{n} + \addf{n}(\epart{n}{J_{n + 1}^{(1,1)}}, \epart{n + 1}{1}) \cond \calG{n + 1}{\N}\right]^2 \cond \calF{n}{\N} \right]. 
\end{align*}
Here the first term is given by
\begin{align}
a_\N' &= \K^{-1} \sum_{i = 1}^\N \frac{\ewght{n}{i}\adjfuncforward{n}(\epart{n}{i})}{\sum_{i' = 1}^{\N} \ewght{n}{i'} \adjfuncforward{n}(\epart{n}{i'})} \int \wgtfuncmod{n}(\epart{n}{i}, x) f_{n + 1}(x) \nonumber \\
&\hspace{3cm}\times \sum_{j = 1}^\N \frac{\ewght{n}{j} \udmod{n}(\epart{n}{j}, x)}{\sum_{j' = 1}^{\N} \ewght{n}{j'} \udmod{n}(\epart{n}{j'}, x)} \left(\tstat[j]{n} + \addf{n}(\epart{n}{j}, x) \right)^2  \kissforward{n}{n}(\epart{n}{i},x) \, \mu(\rmd x), \nonumber \\
&= (\K \post[\N]{n}\adjfuncforward{n})^{-1} \sum_{j = 1}^\N \frac{\ewght{n}{j}}{\sumwght{n}} \int f_{n + 1}(x) \left( \tstat[j]{n} + \addf{n}(\epart{n}{j}, x) \right)^2 \, \ukmod{n}(\epart{n}{j}, \rmd x). \label{eq:a':1}
\end{align}
Thus, by the induction hypothesis and Proposition~\ref{prop:hoeffding:tau:marginal}, $a_\N'$ tends in probability to 
\begin{multline*}
(\K \postmod{n}\adjfuncforward{n})^{-1} \left(\eta_n \ukmod{n} f_{n + 1} + \postmod{n}\{(\tstatmod{n} h_n)^2 \ukmod{n} f_{n+1}\} + \postmod{n} \ukmod{n}(f_{n + 1} \addf{n}^2)  + 2 \postmod{n}\{\tstatmod{n} h_n \ukmod{n}(f_{n + 1} \addf{n})\} \right) \\
= (\K \postmod{n} \adjfuncforward{n})^{-1} \left(\eta_n \ukmod{n} f_{n + 1} + \postmod{n} \ukmod{n} \{(\tstatmod{n} h_n +\addf{n})^2 f_{n + 1} \} \right). 
\end{multline*}

We turn to the second term. Along the lines of \eqref{eq:a':1} we may write  
$$
a_\N'' = (\K - 1) \K^{-1} \frac{\post[\N]{n}(\ukmod{n} \varphi_N)}{\post[\N]{n} \adjfuncforward{n}}
$$
with
\[
\varphi_\N(x) \eqdef f_{n+1}(x) \left\{ \sum_{i = 1}^\N \frac{\ewght{n}{i} \udmod{n}(\epart{n}{i}, x)}{\sum_{i' = 1}^{\N} \ewght{n}{i'} \udmod{n} (\epart{n}{i'}, x)} \left( \tstat[i]{n} + \addf{n}(\epart{n}{i}, x) \right) \right\}^2, \quad x \in \Xset_{n + 1}. 
\]
Now, Proposition~\ref{prop:hoeffding:tau:marginal} implies pointwise convergence of $\varphi_\N$ in the sense that for all $x \in \Xset_{n + 1}$, $\pP$-a.s., 
\begin{align*}
\lim_{\N \to \infty} \varphi_\N(x) &= f_{n + 1}(x) \left(\frac{\postmod{n}[\tstatmod{n} h_n \udmod{n}(\cdot, x) + \addf{n}(\cdot, x) \udmod{n}(\cdot, x)]}{\postmod{n}[\udmod{n}(\cdot, x)]} \right)^2 \\
&= f_{n + 1}(x) (\bkmod{n})^2(\tstatmod{n} h_n + \addf{n})(x) \\
&= f_{n + 1}(x) (\tstatmod{n + 1})^2 h_{n + 1}(x). 
\end{align*}
Therefore, since $\| \varphi_N \|_\infty \leq \| f_{n + 1} \|_\infty \| h_{n + 1} \|^2_\infty$ for all $\N$, we may apply Lemma~\ref{lem:generalized:lebesgue} in order to obtain the limit  
\[
a_\N'' \pplim (\K - 1) \K^{-1} \frac{\postmod{n} \ukmod{n}\{f_{n + 1} (\tstatmod{n + 1})^2 h_{n + 1}\}}{\postmod{n}\adjfuncforward{n}}. 
\]
Finally, by Proposition~\ref{prop:hoeffding:tau:marginal}(i), $\pP$-a.s., 
\begin{equation} \label{eq:b:lim}
\lim_{\N \to \infty} b_\N = \frac{\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}}}{\postmod{n} \adjfuncforward{n}}, 
\end{equation}
and using \eqref{eq:recursion:FK:marg} yields the limit
\begin{multline}
\frac{a_\N}{b_\N} \pplim \postmod{n + 1}\{f_{n + 1} (\tstatmod{n + 1})^2 h_{n + 1}\} \\
+ \K^{-1} \frac{\eta_n \ukmod{n} f_{n + 1} + \postmod{n} \ukmod{n}\{(\tstatmod{n} h_n +\addf{n})^2 f_{n + 1}\} - \postmod{n} \ukmod{n}\{f_{n + 1} (\tstatmod{n+1})^2 h_{n + 1}\}}{\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}}}.
\end{multline}
Thus, we may complete the proof by noting, using Lemma~\ref{lem:reversibility}(i), that
\begin{multline*}
\postmod{n} \ukmod{n}\{(\tstatmod{n} h_n +\addf{n})^2 f_{n + 1}\} - \postmod{n} \ukmod{n}\{f_{n + 1} (\tstatmod{n + 1})^2 h_{n + 1}\} \\
= \postmod{n} \ukmod{n} \{ \bkmod{n}(\tstatmod{n} h_n + \addf{n} - \tstat{n + 1} h_{n + 1})^2 f_{n+1}\}.  
\end{multline*}
\end{proof}

\begin{proof}[Proof of Theorem~\ref{prop:clt:pseudo:marginal:paris}]
We proceed by induction over $n$ and assume that the result holds for some $n \in \nset$. In addition, we first assume that $\postmod{n + 1}(\tstatmod{n + 1} h_{n + 1} f_{n + 1} + \ftd{n + 1}) = 0$ (this assumption will be removed in the end of the proof). Write
\begin{equation} \label{eq:main:decomp:CLT}
\sqrt{N} \sum_{i = 1}^\N \frac{\ewght{n + 1}{i}}{\sumwght{n + 1}}\{\tstat[i]{n + 1} f_{n + 1}(\epart{n + 1}{i}) +  \ftd{n + 1}(\epart{n + 1}{i})\} = (\sumwght{n + 1} / \N)^{-1} (\termprime + \termbis) / \N,
\end{equation}
where 
\begin{align*}
\termprime &\eqdef \sqrt{\N} \sum_{i = 1}^\N \pE \left[ \ewght{n + 1}{i}\{\tstat[i]{n + 1}f_{n + 1}(\epart{n + 1}{i}) + \ftd{n + 1}(\epart{n + 1}{i})\} \cond \calF{n}{\N} \right],\\
 \termbis &\eqdef \sqrt{\N} \sum_{i = 1}^N \left( \ewght{n+1}{i}\{\tstat[i]{n+1}f_{n+1}(\epart{n+1}{i}) + \ftd{n+1}(\epart{n+1}{i})\}\right.\\
&\left.\hspace{4cm} - \pE \left[\ewght{n+1}{i} \{ \tstat[i]{n+1} f_{n+1}(\epart{n+1}{i}) + \ftd{n+1}(\epart{n+1}{i})\} \cond \calF{n}{\N} \right] \right).
\end{align*}
In the following we establish the weak limit of $(\termprime + \termbis) / \N$, from which the weak limit of \eqref{eq:main:decomp:CLT} follows by Slutsky's lemma. In order to treat the first term $\termprime / \N$ of the decomposition \eqref{eq:main:decomp:CLT}, write, using Lemma~\ref{lem:expectation:incremental:marginal},
\[
\termprime / \N = \sqrt{\N} (\post[\N]{n} \adjfuncforward{n})^{-1} \sum_{i = 1}^N \frac{\ewght{n}{i}}{\sumwght{n}} \{ \tstat[i]{n} \ukmod{n} f_{n + 1}(\epart{n}{i}) + \ukmod{n}(\addf{n} f_{n + 1} + \ftd{n + 1})(\epart{n}{i}) \}.
\]
In the previous expression, $\lim_{\N \to \infty} \post[\N]{n} \adjfuncforward{n} = \postmod{n} \adjfuncforward{n} > 0$, $\pP$-a.s., by proposition~\ref{prop:hoeffding:tau:marginal}. In addition, by Lemma~\ref{lem:reversibility}(i), 
\begin{align*}
\lefteqn{\postmod{n} \{ \tstatmod{n} h_n \ukmod{n} f_{n + 1} + \ukmod{n}(\addf{n} f_{n + 1} + \ftd{n + 1}) \}} \\
&= \iint \postmod{n} \ukmod{n}(\rmd x_{n + 1}) \, \bkmod{n}(x_{n + 1}, \rmd x_n) \{ \tstatmod{n} h_n(x_n) f_{n + 1}(x_{n + 1}) + \addf{n}(x_n, x_{n + 1}) f_{n + 1}(x_{n + 1}) + \ftd{n + 1}(x_{n + 1}) \} \\
&= \postmod{n} \ukmod{n} \1_{\Xset_{n + 1}} \times \postmod{n + 1}(\tstatmod{n + 1} h_{n + 1} f_{n + 1} + \ftd{n + 1}) = 0,
\end{align*}
where the last equality holds by assumption. Thus, applying the induction hypothesis and Slutsky's lemma yields 
\begin{equation} \label{eq:weak:limit:termprime}
\lim_{N \to \infty} \pE \left[ \exp \left(\im u \termprime / \N \right) \right] = \exp \left( - u^2 \frac{\sigma_n^2 \langle \ukmod{n} f_{n + 1}; \ukmod{n}(\addf{n} f_{n + 1} + \ftd{n + 1}) \rangle}{2 (\postmod{n} \adjfuncforward{n})^2} \right).  
\end{equation}

We turn to the second term of \eqref{eq:main:decomp:CLT}. By Lemma~\ref{lem:expectation:incremental:marginal}, $\termbis / \N = \sum_{i = 1}^\N \upsilon^i_\N$, where
$$
\upsilon^i_\N \eqdef \frac{1}{\K \sqrt{\N}} \sum_{j = 1}^{\K} \tilde{\upsilon}_\N(I_{n + 1}^i, J_{n + 1}^{(i, j)}, \epart{n + 1}{i}, \zpart{n + 1}{i}),
$$
with
\begin{multline*}
\tilde{\upsilon}_\N(i, j, x, z) \eqdef \wgtfunc{n}(\epart{n}{i}, x, z)
\left( \{\tstat[j]{n} + \addf{n}(\epart{n}{j}, x)\} f_{n + 1}(x) + \ftd{n + 1}(x) \right) \\
 -  (\post[\N]{n} \adjfuncforward{n})^{-1} \sum_{\ell = 1}^\N \frac{\ewght{n}{\ell}}{\sumwght{n}} \{ \tstat[\ell]{n} \ukmod{n} f_{n + 1}(\epart{n}{\ell}) + \ukmod{n}(\addf{n} f_{n + 1} + \ftd{n + 1})(\epart{n}{\ell}) \}, \\
 \quad (i, j, x, z) \in \intvect{1}{\N}^2 \times \Xset_{n + 1} \times \Zset_{n + 1}.
\end{multline*}
\begin{remark} \label{rem:non-trivial:extension}
In the framework of a fully dominated HMM and a PaRIS driven by the standard bootstrap particle filter, which was the setting considered in \cite{olsson:westerborn:2014b}, the function $\tilde{\upsilon}_\N$ does not, on the contrary to the general case considered here, depend on $i$. As we will see in the next derivations, this dependence calls for a non-trivial refinement of the proof of \cite[Theorem~3]{olsson:westerborn:2014b}. 
\end{remark}

In the following we establish the weak limit of $\sum_{i = 1}^\N \upsilon^i_\N$ using \cite[Theorem~A.3]{douc:moulines:2008}. By construction, $\pE[\upsilon^i_\N \mid \calF{n}{\N}] = 0$; thus, the condition (31) in the mentioned theorem can be checked by establishing that 
\begin{multline}
\label{eq:decomp:sum:square:upsilon}
\sum_{i = 1}^\N \pE[(\upsilon^i_\N)^2 \mid \calF{n}{\N}] = \K^{-1} \pE \left[  \pE \left[ \tilde{\upsilon}_\N^2(I_{n + 1}^1, J_{n + 1}^{(1,1)}, \epart{n + 1}{1}, \zpart{n + 1}{1}) \mid \calG{n + 1}{\N} \right] \mid \calF{n}{\N} \right] \\
 + (\K - 1) \K^{-1} \pE \left[ \pE^2 \left[ \tilde{\upsilon}_\N(I_{n + 1}^1, J_{n + 1}^{(1,1)}, \epart{n + 1}{1}, \zpart{n + 1}{1}) \mid \calG{n + 1}{\N} \right] \mid \calF{n}{\N} \right] 
\end{multline}
converges in probability as $\N \to \infty$. The first term of \eqref{eq:decomp:sum:square:upsilon} is given by
\begin{align}
\lefteqn{\pE\left[ \pE\left[ \tilde{\upsilon}^2_\N(I_{n + 1}^1,J_{n + 1}^{(1,1)}, \epart{n + 1}{1}, \zpart{n + 1}{1}) \cond \calG{n + 1}{\N} \right] \cond \calF{n}{\N}\right]} \hspace{10mm} \nonumber \\
&= \pE\left[\sum_{j = 1}^\N \frac{\ewght{n}{j} \udmod{n} (\epart{n}{j}, \epart{n + 1}{1})}{\sum_{j' = 1}^\N \ewght{n}{j'} \udmod{n} (\epart{n}{j'}, \epart{n + 1}{1})} \int \tilde{\upsilon}^2_N(I_{n + 1}^1, j, \epart{n + 1}{1}, z) \, \ukdist{n}(\epart{n}{\ind{n + 1}{1}}, \epart{n + 1}{1}, \rmd z) \cond \calF{n}{\N} \right], \nonumber \\
&= \sum_{i = 1}^\N \frac{\ewght{n}{i} \adjfuncforward{n}(\epart{n}{i})}{\sum_{i' = 1}^\N \ewght{n}{i'} \adjfuncforward{n}(\epart{n}{i'})} \int \kissforward{n}{n}(\epart{n}{i}, x)
\sum_{j = 1}^\N \frac{\ewght{n}{j} \udmod{n} (\epart{n}{j}, x)}{\sum_{j' = 1}^{\N} \ewght{n}{j'} \udmod{n} (\epart{n}{j'}, x)} \int \tilde{\upsilon}^2_\N(i, j,x, z) \, \ukdist{n}(\epart{n}{i}, x, \rmd z) \, \mu(\rmd x) \nonumber \\
&= (\post[\N]{n} \adjfuncforward{n})^{-1} (a_\N + b_\N + c_\N) \nonumber \\
&\hspace{10mm} - (\post[\N]{n} \adjfuncforward{n})^{-2} \left(\sum_{\ell=1}^\N \frac{\ewght{n}{\ell}}{\sumwght{n}} \{ \tstat[\ell]{n} \ukmod{n} f_{n + 1}(\epart{n}{\ell}) + \ukmod{n}(\addf{n} f_{n + 1} + \ftd{n + 1})(\epart{n}{\ell}) \} \right)^2, \label{eq:upsilon:2:decomp} 
\end{align}
where
\begin{align*}
a_\N &\eqdef \sum_{j = 1}^\N \frac{\ewght{n}{j}}{\sumwght{n}}(\tstat[j]{n})^2  \int \udmod{n} (\epart{n}{j}, x) \varphi_\N(x) f_{n + 1}^2(x) \, \mu(\rmd x), \\
b_\N &\eqdef \sum_{i = 1}^\N \frac{\ewght{n}{i}}{\sumwght{n}} \int \lwd{n}(\epart{n}{i}, x) \sum_{j = 1}^\N \frac{\ewght{n}{j} \udmod{n} (\epart{n}{j}, x)}{\sum_{j' = 1}^{\N} \ewght{n}{j'} \udmod{n} (\epart{n}{j'}, x) }\left( \addf{n}(\epart{n}{j}, x) f_{n + 1}(x) + \ftd{n + 1}(x) \right)^2 \, \mu(\rmd x), \\
c_\N &\eqdef  2 \sum_{j = 1}^\N \frac{\ewght{n}{j}}{\sumwght{n}} \tstat[j]{n} \int  \udmod{n}(\epart{n}{j}, x) \varphi_N(x) f_{n + 1}(x) \left( \addf{n}(\epart{n}{j}, x) f_{n + 1}(x) + \ftd{n + 1}(x) \right) \, \mu(\rmd x),
\end{align*}
with 
$$
\varphi_\N(x) \eqdef \frac{\sum_{i = 1}^\N \ewght{n}{i} \lwd{n}(\epart{n}{i}, x)}{\sum_{j' = 1}^\N \ewght{n}{j'} \udmod{n}(\epart{n}{j'}, x)}, \quad x \in \Xset_{n + 1},   
$$
being a random function and 
$$
\lwd{n}(x_n, x_{n + 1}) \eqdef \int \ukest{n}{z}(x_n, x_{n + 1}) \wgtfunc{n}(x_n, x_{n + 1}, z) \, \ukdist{n}(x_n, x_{n + 1}, \rmd z), \quad (x_n, x_{n + 1}) \in \Xset_n \times \Xset_{n + 1},  
$$
an unnormalised transition density. Define the deterministic function $\varphi(x) \eqdef \post{n}[\lwd{n}(\cdot, x)] / \post{n}[\udmod{n}(\cdot, x)]$, $x \in \Xset_{n + 1}$; then by Proposition~\ref{prop:hoeffding:tau:marginal}, $\pP$-a.s., $\lim_{\N \to \infty} \varphi_\N(x) = \varphi(x)$ for all $x$. Thus, since 
\begin{multline} \label{eq:a:bound}
\left| a_\N -  \sum_{j = 1}^\N \frac{\ewght{n}{j}}{\sumwght{n}}(\tstat[j]{n})^2 \int \udmod{n}(\epart{n}{j}, x) f_{n + 1}^2(x) \varphi(x) \, \mu(\rmd x) \right| \\
\leq \| h_n \|^2_\infty \sum_{j = 1}^\N \frac{\ewght{n}{j}}{\sumwght{n}} \int \udmod{n}(\epart{n}{j}, x) f_{n + 1}^2(x) |\varphi_\N(x) - \varphi(x)| \, \mu(\rmd x)   
\end{multline}
and $f_{n + 1}^2(x) |\varphi_\N(x) - \varphi(x)| \leq 2 \| \wgtfunc{n} \|_\infty \| f_{n + 1} \|_\infty^2$ for all $x$, Lemma~\ref{lem:generalized:lebesgue} implies that the right-hand side of \eqref{eq:a:bound} tends to zero as $\N \to \infty$. Thus, 
by Lemma~\ref{lem:hoeffding:tau:square},
\[
a_\N \pplim \eta_n \ukmod{n}(f^2_{n + 1} \varphi)  + \postmod{n} \{ (\tstatmod{n})^2 h_n \ukmod{n}(f^2_{n + 1} \varphi) \}.
\]

We compute the limit of $b_\N$. For this purpose, define the mapping 
\[
 \psi_\N(x) \eqdef \sum_{j = 1}^\N \frac{\ewght{n}{j} \udmod{n}(\epart{n}{j}, x)}{\sum_{j' = 1}^\N \ewght{n}{j'} \udmod{n} (\epart{n}{j'}, x)} \left( \addf{n}(\epart{n}{j}, x) f_{n + 1}(x) + \ftd{n + 1}(x) \right)^2, \quad x \in \Xset_{n + 1}. 
\]
which tends, for all $x$, by Proposition~\ref{prop:hoeffding:tau:marginal}, $\pP$-a.s. to 
$$
\psi(x) \eqdef \bkmod{n}(\addf{n} f_{n + 1} + \ftd{n + 1})^2(x). 
$$
Moreover, since $\psi_\N(x) \leq (\| \addf{n} \|_\infty \|f_{n + 1} \|_\infty + \| \ftd{n + 1} \|_\infty)^2$ for all $x$, Lemma~\ref{lem:generalized:lebesgue} implies that 
\begin{align*}
\lefteqn{b_\N \pplim \int \post{n} [\lwd{n}(\cdot, x)] \psi(x) \, \mu(\rmd x)} \hspace{20mm} \\
&= \iint \lwd{n}(x_n, x_{n + 1}) \bkmod{n}(\addf{n} f_{n + 1} + \ftd{n + 1})^2(x_{n + 1}) \, \postmod{n}(\rmd x_n) \, \mu(\rmd x_{n + 1}) \\
&= \postmod{n} \ukmod{n}\{ \varphi (\addf{n} f_{n + 1} + \ftd{n + 1})^2 \},  
\end{align*}
where the last equality is obtained using Lemma~\ref{lem:reversibility}(i).
 
We turn to the last term, $c_\N$. Since 
\begin{multline*}
\left| c_\N -  2 \sum_{j = 1}^\N \frac{\ewght{n}{j}}{\sumwght{n}} \tstat[j]{n} \int \udmod{n} (\epart{n}{j}, x) f_{n + 1}(x) \varphi(x) \left( \addf{n}(\epart{n}{j} ,x) f_{n + 1}(x) + \ftd{n + 1}(x)\right) \, \mu(\rmd x) \right| \\
\leq \| h_n \|_{\infty}( \| \addf{n} \|_\infty \| f_{n + 1} \|_\infty + \| \ftd{n + 1} \|_\infty) \sum_{j = 1}^\N \frac{\ewght{n}{j}}{\sumwght{n}} \int \udmod{n}(\epart{n}{j}, x) f_{n + 1}(x) |\varphi_\N(x) - \varphi(x)| \, \mu(\rmd x),   
\end{multline*}
where the right-hand side tends, by Lemma~\ref{lem:generalized:lebesgue}, to zero in probability as $\N \to \infty$, using again Proposition~\ref{prop:hoeffding:tau:marginal} yields
\[
c_\N \pplim 2 \postmod{n} \{ \tstatmod{n} h_n \ukmod{n} [\varphi f_{n + 1}( \addf{n} f_{n + 1} + \ftd{n +1})] \}. 
\]

Finally, by Proposition~\ref{prop:hoeffding:tau:marginal}, $\pP$-a.s., 
\begin{multline} \label{eq:zero:limit}
\lim_{\N \to \infty} \sum_{\ell = 1}^N \frac{\ewght{n}{\ell}}{\sumwght{n}} \{ \tstat[\ell]{n} \ukmod{n} f_{n + 1}(\epart{n}{\ell}) + \ukmod{n}(\addf{n} f_{n + 1} + \ftd{n + 1})(\epart{n}{\ell}) \} \\
=  \postmod{n}\{ \tstatmod{n} h_n \ukmod{n} f_{n + 1} + \ukmod{n}(\addf{n} f_{n + 1} + \ftd{n + 1})\} = 0,
\end{multline}
where the last equality follows by Lemma~\ref{eq:critical:identity} and assumption, and since also $\lim_{\N \to \infty}\post[\N]{n} \adjfuncforward{n} = \postmod{n} \adjfuncforward{n}$, $\pP$-a.s., the second term of \eqref{eq:upsilon:2:decomp} tends $\pP$-a.s. to zero.   

To sum up, as $\N \to \infty$, the first term of \eqref{eq:decomp:sum:square:upsilon} satisfies the limit 
\begin{multline} \label{eq:limit:first:term:i}
\K^{-1} \pE \left[ \pE \left[\tilde{\upsilon}_\N^2(I_{n + 1}^1, J_{n + 1}^{(1,1)}, \epart{n + 1}{1}, \zpart{n + 1}{1}) \cond \calG{n + 1}{\N} \right] \cond \calF{n}{\N} \right] \\
\pplim (\K \postmod{n} \adjfuncforward{n})^{-1} \left( \eta_n \ukmod{n}(f^2_{n + 1} \varphi) + \postmod{n} \ukmod{n} \{ \varphi [(\tstatmod{n} h_n + \addf{n}) f_{n+1} + \ftd{n + 1}]^2 \} \right). 
\end{multline}

We turn to the second term of \eqref{eq:decomp:sum:square:upsilon} and write 
\begin{align*}
\lefteqn{\pE \left[ \pE^2 \left[ \tilde{\upsilon}_\N(I_{n + 1}^1, J_{n + 1}^{(1,1)}, \epart{n + 1}{1}, \zpart{n + 1}{1}) \cond \calG{n + 1}{\N} \right] \cond \calF{n}{\N} \right]} \hspace{5mm} \\
&= \pE\left[ \left( \sum_{j = 1}^\N \frac{\ewght{n}{j} \udmod{n}(\epart{n}{j}, \epart{n + 1}{1})}{\sum_{j' = 1}^\N \ewght{n}{j'} \udmod{n}(\epart{n}{j'}, \epart{n + 1}{1}) } \int \tilde{\upsilon}_\N(\ind{n + 1}{1}, j, \epart{n + 1}{1}, z) \, \ukdist{n}(\epart{n}{\ind{n + 1}{1}}, \epart{n + 1}{1}, \rmd z) \right)^2 \cond \calF{n}{\N}\right] \\
&= \sum_{i = 1}^{\N}  \frac{\ewght{n}{i} \adjfuncforward{n}(\epart{n}{i})}{\sum_{i' = 1}^\N \ewght{n}{i'}\adjfuncforward{n}(\epart{n}{i'})} \int \left( \sum_{j = 1}^\N \frac{\ewght{n}{j} \udmod{n} (\epart{n}{j}, x)}{\sum_{j' = 1}^{\N} \ewght{n}{j'} \udmod{n}(\epart{n}{j'}, x)} \int \tilde{\upsilon}_\N(i, j, x, z) \, \ukdist{n}(\epart{n}{i}, x, \rmd z)\right)^2 
\prop{n}(\epart{n}{i}, \rmd x) \\
&= (\post[\N]{n} \adjfuncforward{n})^{-1} \sum_{i = 1}^\N \frac{\ewght{n}{i}}{\sumwght{n}} \int \wgtfuncmod{n}(\epart{n}{i}, x) \gamma_\N^2(x) \, \ukmod{n}(\epart{n}{i}, \rmd x) \\ 
&\hspace{10mm} - 2 (\post[\N]{n} \adjfuncforward{n})^{-1} (\post[\N]{n} \ukmod{n} \gamma_\N) \sum_{\ell = 1}^\N \frac{\ewght{n}{\ell}}{\sumwght{n}} \{ \tstat[\ell]{n} \ukmod{n} f_{n + 1}(\epart{n}{\ell}) + \ukmod{n}(\addf{n} f_{n + 1} + \ftd{n + 1})(\epart{n}{\ell}) \} \\
&\hspace{20mm} + (\post[\N]{n} \adjfuncforward{n})^{-1} \left( \sum_{\ell = 1}^\N \frac{\ewght{n}{\ell}}{\sumwght{n}} \{ \tstat[\ell]{n} \ukmod{n} f_{n + 1}(\epart{n}{\ell}) + \ukmod{n}(\addf{n} f_{n + 1} + \ftd{n + 1})(\epart{n}{\ell})\} \right)^2, 
\end{align*}
where 
$$
\gamma_\N(x) \eqdef f_{n + 1}(x) \sum_{j = 1}^\N \frac{\ewght{n}{j} \udmod{n} (\epart{n}{j}, x)}{\sum_{j' = 1}^\N \ewght{n}{j'} \udmod{n}(\epart{n}{j'}, x)} \left(\tstat[j]{n} + \addf{n}(\epart{n}{j}, x) \right) + \ftd{n + 1}(x), \quad x \in \Xset_{n + 1}. 
$$
Since, by Proposition~\ref{prop:hoeffding:tau:marginal}, for all $x_{n + 1} \in \Xset$, $\lim_{\N \to \infty} \gamma_\N(x) = \gamma(x)$ $\pP$-a.s., where 
$$
\gamma(x) \eqdef f_{n + 1}(x) \bkmod{n}(\tstatmod{n} h_n + \addf{n})(x) + \ftd{n + 1}(x) = f_{n + 1}(x) \tstatmod{n + 1} h_{n + 1}(x) + \ftd{n + 1}(x),  
$$
Lemma~\ref{lem:generalized:lebesgue} implies that  
\begin{multline} \label{eq:limit:second:term:i}
 \sum_{i = 1}^\N \frac{\ewght{n}{i}}{\sumwght{n}} \int \wgtfuncmod{n}(\epart{n}{i}, x) \gamma_\N^2(x) \, \ukmod{n}(\epart{n}{i}, \rmd x) \\
\pplim \iint \wgtfuncmod{n}(x_n, x_{n + 1}) \gamma^2(x_{n + 1}) \, \postmod{n}(\rmd x_n) \, \ukmod{n}(x_n, \rmd x_{n + 1})
\end{multline}
and $\post[\N]{n} \ukmod{n} \gamma_\N \pplim \postmod{n} \ukmod{n} \gamma$. 
Thus, by (\ref{eq:zero:limit}--\ref{eq:limit:second:term:i}), 
\begin{multline*}
\sum_{i = 1}^\N \pE[(\upsilon^i_\N)^2 \mid \calF{n}{\N}] \pplim 
\incrementalvar_n^2 \langle f_{n + 1}, \ftd{n + 1} \rangle(h_n) \\ 
\eqdef (\K \postmod{n} \adjfuncforward{n})^{-1} \left( \eta_n \ukmod{n}(f^2_{n + 1} \varphi) + \postmod{n} \ukmod{n} \{ \varphi [(\tstatmod{n} h_n + \addf{n}) f_{n + 1} + \ftd{n + 1}]^2 \} \right.  \\
\left. \vphantom{\eta_n \ukmod{n}(f^2_{n + 1} \varphi + \post{n} \uk{n} \{(\bkw{\post{n}} \wgtfunc{n}) [(\tstat{n} h_n + \addf{n}) f_{n+1} + \ftd{n + 1}]^2 \}} + (\K - 1) \postmod{n} \ukmod{n}\{\wgtfuncmod{n}(f_{n + 1} \tstatmod{n + 1} h_{n + 1} + \ftd{n + 1})^2 \} \right), 
\end{multline*}
which verifies condition (i) in \cite[Theorem~A.3]{douc:moulines:2008}. Now, with the conditional relative weight variance $\ukestvar{n}$ defined as in \eqref{eq:def:ukestvar} it holds that  
$$
\varphi(x) - \bkmod{n} \wgtfuncmod{n}(x) = \frac{\postmod{n}[\udmod{n}(\cdot, x) \ukestvar{n}(\cdot, x)]}{\postmod{n}[\udmod{n}(\cdot, x)]} = \bkmod{n} \ukestvar{n}(x). 
$$
Then, since, applying Lemma~\ref{lem:reversibility}(i) (twice),
\begin{multline*}
\lefteqn{\postmod{n} \ukmod{n} \{\varphi [(\tstatmod{n} h_n + \addf{n}) f_{n + 1} + \ftd{n + 1}]^2 \} -  \postmod{n} \ukmod{n}\{\wgtfuncmod{n}(f_{n + 1} \tstatmod{n + 1} h_{n + 1} + \ftd{n + 1})^2 \}} \\
= \postmod{n} \ukmod{n} \{ \wgtfuncmod{n} f_{n + 1}^2 \bkmod{n} (\tstatmod{n} h_n + \addf{n} - \tstatmod{n + 1} h_{n + 1})^2 \} + \postmod{n} \ukmod{n} \{ \bkmod{n} \ukestvar{n} [(\tstatmod{n} h_n + \addf{n}) f_{n + 1} + \ftd{n + 1}]^2 \}, 
\end{multline*}
we may express the previous limit as 
\begin{multline*}
\incrementalvar_n^2 \langle f_{n + 1}, \ftd{n + 1} \rangle =  (\K \postmod{n} \adjfuncforward{n})^{-1} \left( \vphantom{\postmod{n} \ukmod{n} \{ \wgtfuncmod{n} f_{n + 1}^2 \bkmod{\postmod{n}} (\tstatmod{n} h_n + \addf{n} - \tstatmod{n + 1} h_{n + 1})^2 \} + \K \postmod{n} \ukmod{n} \{\wgtfuncmod{n}(f_{n + 1} \tstat{n + 1} h_{n + 1} + \ftd{n + 1})^2} \eta_n \ukmod{n}(f^2_{n + 1} \bkmod{n} \wgtfuncmod{n}) \right. \\
\left. + \postmod{n} \ukmod{n} \{ \wgtfuncmod{n} f_{n + 1}^2 \bkmod{n} (\tstatmod{n} h_n + \addf{n} - \tstatmod{n + 1} h_{n + 1})^2 \} + \K \postmod{n} \ukmod{n} \{ \wgtfuncmod{n}(f_{n + 1} \tstatmod{n + 1} h_{n + 1} + \ftd{n + 1})^2 \} \right. \\
\left. \vphantom{\post{n} \uk{n} \{ \wgtfunc{n} f_{n + 1}^2 \bkw{\post{n}} (\tstat{n} h_n + \addf{n} - \tstat{n + 1} h_{n + 1})^2 \} + \K \post{n} \uk{n} \{\wgtfunc{n}(f_{n + 1} \tstat{n + 1} h_{n + 1} + \ftd{n + 1})^2}
+ \eta_n \ukmod{n}(f^2_{n + 1} \bkmod{n} \ukestvar{n}) + \postmod{n} \ukmod{n} \{ \bkmod{n} \ukestvar{n} [(\tstatmod{n} h_n + \addf{n}) f_{n + 1} + \ftd{n + 1}]^2 \}
\right).  
\end{multline*}

Condition~(ii) in \cite[Theorem~A.3]{douc:moulines:2008} is satisfied as an immediate consequence of  \hypref{assum:bound:filter:pseudomarginal}; indeed, since $| \upsilon^i_\N | \leq d_n / \sqrt{\N}$ for all $i \in \intvect{1}{\N}$, where 
$d_n \eqdef 2 \| \wgtfunc{n} \|_\infty (\| h_{n + 1} \|_\infty \| f_{n + 1} \|_\infty + \| \ftd{n + 1} \|_\infty)$, it holds for all $\epsilon>0$, $\pP$-a.s.,
\[
\sum_{i = 1}^\N \pE \left[ (\upsilon^i_\N)^2 \1_{\{|\upsilon^i_\N| \geq \epsilon\}} \cond \calF{n}{\N} \right] \leq d_n^2 \1_{\{ d_n \geq \epsilon \sqrt{\N} \}}, 
\]
where the right-hand side tends to zero as $\N \to \infty$. Thus, \cite[Theorem~A.3]{douc:moulines:2008} provides the limit 
$$
\pE \left[ \exp \left(\im u \termbis / \N \right) \cond \calF{n}{\N} \right] \pplim \exp \left( - u^2 \incrementalvar_n^2 \langle f_{n + 1}, \ftd{n + 1} \rangle / 2 \right).    
$$
Now, since $\lim_{\N \to \infty} \sumwght{n + 1} / \N = \postmod{n} \ukmod{n} \1_{\Xset_{n + 1}} / \postmod{n} \adjfuncforward{n}$ $\pP$-a.s. by Proposition~\ref{prop:hoeffding:tau:marginal}, we may combine the previous limit with \eqref{eq:weak:limit:termprime}, \cite[Lemma~A.5]{delmoral:moulines:olsson:verge:2016}, and Slutsky's lemma in order to obtain the weak convergence  
\begin{equation} \label{eq:first:weak:limit}
(\termprime + \termbis) / \sumwght{n + 1} \dlim N \left( 0, \frac{\sigma_n^2(h_n, \ukmod{n} f_{n + 1}, \ukmod{n}(\addf{n} f_{n + 1} + \ftd{n + 1})) + (\postmod{n} \adjfuncforward{n})^2 \incrementalvar_n^2 \langle f_{n + 1}, \ftd{n + 1} \rangle}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} \right).    
\end{equation}
In order to treat the general case where $\postmod{n + 1}(\tstatmod{n + 1} h_{n + 1} f_{n + 1} + \ftd{n + 1})$ is not necessarily zero, define 
\[
\bar{f}_{n + 1} \eqdef \ftd{n + 1} - \postmod{n + 1}(\tstatmod{n + 1} h_{n + 1} f_{n + 1} + \ftd{n + 1}). 
\]
Since the functions $f_{n + 1}$ and $\bar{f}_{n + 1}$ belong to $\bmf{\Xfd_{n + 1}}$ and satisfy $\postmod{n + 1}(\tstatmod{n + 1} h_{n+1} f_{n + 1} + \bar{f}_{n + 1}) = 0$, \eqref{eq:first:weak:limit} provides    
\begin{multline*}
\sqrt{\N} \left( \sum_{i = 1}^\N \frac{\ewght{n + 1}{i}}{\sumwght{n + 1}}\{\tstat[i]{n + 1} f_{n + 1}(\epart{n + 1}{i}) +  \ftd{n + 1}(\epart{n + 1}{i})\} - \postmod{n + 1}(\tstatmod{n + 1} h_{n + 1} f_{n + 1} + \ftd{n + 1}) \right) \\
= \sqrt{\N} \left( \sum_{i = 1}^\N \frac{\ewght{n + 1}{i}}{\sumwght{n + 1}}\{\tstat[i]{n + 1} f_{n + 1}(\epart{n + 1}{i}) +  \bar{f}_{n + 1}(\epart{n + 1}{i})\} \right) \dlim N \left(0, \sigma_{n + 1}^2 (h_{n + 1}, f_{n + 1}, \ftd{n + 1}) \right), 
\end{multline*}
where 
\begin{multline} \label{eq:as:var:first:expression}
\sigma^2_{n + 1}(h_{n + 1}, f_{n + 1}, \ftd{n + 1}) \\ 
\eqdef \frac{\sigma_n^2(h_n, \ukmod{n} f_{n + 1}, \ukmod{n}(\addf{n} f_{n + 1} + \bar{f}_{n + 1})) + (\postmod{n} \adjfuncforward{n})^2 \incrementalvar_n^2 \langle f_{n + 1}, \bar{f}_{n + 1} \rangle}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} \\
= \frac{\sigma^2_n(h_n, \ukmod{n} f_{n + 1}, \ukmod{n}(\addf{n} f_{n + 1} + \bar{f}_{n + 1}))}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} +  \frac{\postmod{n} \adjfuncforward{n} \eta_n \ukmod{n}(f^2_{n + 1} \bkmod{n} \wgtfuncmod{n})}{\M (\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2}\\
+ \frac{\postmod{n} \adjfuncforward{n} \postmod{n} \ukmod{n} \{\wgtfuncmod{n}(f_{n + 1} \tstatmod{n + 1} h_{n + 1} + \bar{f}_{n + 1} )^2 \}}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} 
+ \frac{\postmod{n} \adjfuncforward{n} \postmod{n} \ukmod{n} \{\wgtfuncmod{n} f^2_{n + 1} \bkmod{n} (\tstatmod{n} h_n + \addf{n} - \tstatmod{n + 1} h_{n + 1})^2\}}{\M (\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} \\
+ \frac{\postmod{n} \adjfuncforward{n} \eta_n \ukmod{n}(f^2_{n + 1} \bkmod{n} \ukestvar{n})}{\M (\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} + \frac{\postmod{n} \adjfuncforward{n} \postmod{n} \ukmod{n} \{ \bkmod{n} \ukestvar{n} [(\tstatmod{n} h_n + \addf{n}) f_{n + 1} + \bar{f}_{n + 1}]^2 \}}{\M (\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2}. 
\end{multline}
Since by Lemma~\ref{lem:reversibility}(i),
$$
\postmod{n} \ukmod{n} \{\wgtfuncmod{n} f^2_{n + 1} \bkmod{n} (\tstatmod{n} h_n + \addf{n} - \tstatmod{n + 1} h_{n + 1})^2\} = \postmod{n} \ukmod{n} \{ \bkmod{n} (\tstatmod{n} h_n + \addf{n} - \tstatmod{n + 1} h_{n + 1})^2 f^2_{n + 1} \bkmod{n} \wgtfuncmod{n} \}, 
$$
and 
\begin{multline*}
\postmod{n} \ukmod{n} \{ \bkmod{n} \ukestvar{n} [(\tstatmod{n} h_n + \addf{n}) f_{n + 1} + \bar{f}_{n + 1}]^2 \} \\
= \postmod{n} \ukmod{n} \{ \ukestvar{n} (f_{n + 1} \tstatmod{n + 1} h_{n + 1} + \bar{f}_{n + 1})^2 \} + \postmod{n} \ukmod{n} \{ \bkmod{n} (\tstatmod{n} h_n + \addf{n} - \tstatmod{n + 1} h_{n + 1})^2 f_{n + 1}^2 \bkmod{n} \ukestvar{n} \},  
\end{multline*}
inserting the expression of $\eta_n$ given in \eqref{eq:def:etak} into \eqref{eq:as:var:first:expression} yields,   
\begin{multline} \label{eq:as:var:second:expression}
\sigma^2_{n + 1}(h_{n + 1}, f_{n + 1}, \ftd{n + 1}) \\
= \frac{\sigma^2_n(h_n, \ukmod{n} f_{n + 1}, \ukmod{n}(\addf{n} f_{n + 1} + \bar{f}_{n + 1}))}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2}
+ \frac{\postmod{n} \adjfuncforward{n} \postmod{n} \ukmod{n} \{\wgtfuncmod{n}(f_{n + 1} \tstatmod{n + 1} h_{n + 1} + \bar{f}_{n + 1})^2 \}}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} \\
+ \frac{\postmod{n} \adjfuncforward{n}}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} \sum_{m = 0}^n \frac{\postmod{m} \ukmod{m}\{\bkmod{m}(\tstatmod{m} h_m + \addf{m} - \tstatmod{m + 1} h_{m + 1})^2 \ukmod{m + 1, n}(f_{n + 1}^2 \bkmod{n} \wgtfuncmod{n})\}}{\K^{n - m + 1} \postmod{m} \ukmod{m, n - 1} \1_{\Xset_n}} \\
+ \frac{\postmod{n} \adjfuncforward{n} \postmod{n} \ukmod{n} \{\ukestvar{n}(f_{n + 1} \tstatmod{n + 1} h_{n + 1} + \bar{f}_{n + 1})^2 \}}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} \\
+ \frac{\postmod{n} \adjfuncforward{n}}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} \sum_{m = 0}^n \frac{\postmod{m} \ukmod{m}\{\bkmod{m}(\tstatmod{m} h_m + \addf{m} - \tstatmod{m + 1} h_{m + 1})^2 \ukmod{m + 1, n}(f_{n + 1}^2 \bkmod{n} \ukestvar{n})\}}{\K^{n - m + 1} \postmod{m} \ukmod{m, n - 1} \1_{\Xset_n}}. 
\end{multline}

It remains to establish the non-recursive expression \eqref{eq:non-recursive:as:var:affine} of the asymptotic variance. We proceed by induction and assume that \eqref{eq:non-recursive:as:var:affine} holds true at time $n$. Recall the definitions of the kernels $\retrokmodmod_{m, n}$ and $\retrokmodmodnorm_{m, n}$ in \eqref{eq:def:retrokmodmod} and \eqref{eq:def:retrokmodmodnorm}, respectively. First, note that since by Lemma~\ref{eq:critical:identity}, 
$$
\postmod{0:n} \{h_n \ukmod{n} f_{n + 1} + \ukmod{n}(\addf{n} f_{n + 1} + \bar{f}_{n + 1})\} = 0, 
$$
it holds for all $m \in \intvect{0}{n - 1}$,  
\begin{align} 
\lefteqn{\retrokmodmodnorm_{m, n} \{h_n \ukmod{n} f_{n + 1} + \ukmod{n}(\addf{n} f_{n + 1} + \bar{f}_{n + 1})\}} \hspace{15mm} \nonumber \\
&= \retrokmodmod_{m, n} \{h_n \ukmod{n} f_{n + 1} + \ukmod{n}(\addf{n} f_{n + 1} + \bar{f}_{n + 1})\} \nonumber \\ 
&= \retrokmodmod_{m, n + 1} \{ h_{n + 1} f_{n + 1} + \ftd{n + 1} - \postmod{n + 1}(\tstatmod{n + 1} h_{n + 1} f_{n + 1} + \ftd{n + 1}) \} \nonumber \\
&= \retrokmodmodnorm_{m, n + 1}(h_{n + 1} f_{n + 1} + \ftd{n + 1}). \label{eq:retrokmodmodnorm:one:step:forward}
\end{align}
Further, by definition, 
\begin{equation} \label{eq:tstatmod:vs:retrokmodmodnorm}
f_{n + 1} \tstatmod{n + 1} h_{n + 1} + \bar{f}_{n + 1} = \retrokmodmodnorm_{n + 1, n + 1} (h_{n + 1} f_{n + 1} + \ftd{n + 1}).
\end{equation}
Since by \eqref{eq:retrokmodmodnorm:one:step:forward}, 
$$
\frac{\chi (\initwgtfunc
\retrokmodmodnorm_{0, n}
\{ h_n \ukmod{n} f_{n + 1} + \ukmod{n}(\addf{n} f_{n + 1} + \bar{f}_{n + 1})\} )^2}{(\chi \ukmod{0, n - 1} \1_{\Xset^n})^2 (\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} = \frac{\chi \{ \initwgtfunc
\retrokmodmodnorm_{0, n + 1}
( h_{n + 1} f_{n + 1} + \ftd{n + 1}) \}^2}{(\chi \ukmod{0, n} \1_{\Xset^{n + 1}})^2}, 
$$
using the induction hypothesis yields   
\begin{multline*}
 \frac{\sigma^2_n(h_n, \ukmod{n} f_{n + 1}, \ukmod{n}(\addf{n} f_{n + 1} + \bar{f}_{n + 1}))}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} = 
  \frac{\chi \{ \initwgtfunc
  \retrokmodmodnorm_{0, n + 1}
  ( h_{n + 1} f_{n + 1} + \ftd{n + 1}) \}^2}{(\chi \ukmod{0, n} \1_{\Xset^{n + 1}})^2} \\
+ \frac{\sigma^2_n \langle (\wgtfuncmod{\ell})_{\ell = 0}^{n - 1} \rangle(h_n, \ukmod{n} f_{n + 1}, \ukmod{n}(\addf{n} f_{n + 1} + \bar{f}_{n + 1}))}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} \\
+ \frac{\sigma^2_n \langle (\ukestvar{\ell})_{\ell = 0}^{n - 1} \rangle(h_n, \ukmod{n} f_{n + 1}, \ukmod{n}(\addf{n} f_{n + 1} + \bar{f}_{n + 1}))}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2}. 
\end{multline*}
Now, for every $(\varphi_\ell)_{\ell \in \nset}$, using \eqref{eq:partial:variance}, \eqref{eq:retrokmodmodnorm:one:step:forward}, and \eqref{eq:tstatmod:vs:retrokmodmodnorm}, 
\begin{multline*}
\frac{\sigma^2_n \langle (\varphi_\ell)_{\ell = 0}^{n - 1} \rangle(h_n, \ukmod{n} f_{n + 1}, \ukmod{n}(\addf{n} f_{n + 1} + \bar{f}_{n + 1}))}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} 
+ \frac{\postmod{n} \adjfuncforward{n} \postmod{n} \ukmod{n} \{\varphi_n(f_{n + 1} \tstatmod{n + 1} h_{n + 1} + \bar{f}_{n + 1})^2 \}}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} \\
+ \frac{\postmod{n} \adjfuncforward{n}}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} \sum_{m = 0}^n \frac{\postmod{m} \ukmod{m}\{\bkmod{m}(\tstatmod{m} h_m + \addf{m} - \tstatmod{m + 1} h_{m + 1})^2 \ukmod{m + 1, n}(f_{n + 1}^2 \bkmod{n} \varphi_n)\}}{\K^{n - m + 1} \postmod{m} \ukmod{m, n - 1} \1_{\Xset_n}} \\
= \sum_{m = 0}^{n - 1} \frac{\postmod{m} \adjfuncforward{m} \postmod{m} \ukmod{m} \{ \varphi_m [\retrokmodmodnorm_{m + 1, n + 1} (h_{n + 1} f_{n + 1} + \ftd{n + 1})]^2\}}{(\postmod{m} \ukmod{m, n} \1_{\Xset_{n + 1}})^2} \\
+ \sum_{m = 0}^{n - 1} \sum_{\ell = 0}^m \frac{\postmod{m} \adjfuncforward{m} \postmod{\ell} \ukmod{\ell} \{\bkmod{\ell}(\tstatmod{\ell} h_{\ell} + \addf{\ell} - \tstatmod{\ell + 1} h_{\ell +1})^2 \ukmod{\ell + 1, m}( \bkmod{m} \varphi_m 
[\ukmod{m + 1, n} f_{n + 1}]^2 
)\}}{\K^{m - \ell + 1} (\postmod{\ell} \ukmod{\ell, m - 1} \1_{\Xset_m})(\postmod{m} \ukmod{m, n} \1_{\Xset_{n + 1}})^2} \\
+ \frac{\postmod{n} \adjfuncforward{n} \postmod{n} \ukmod{n} \{ \varphi_n  
[\retrokmodmodnorm_{n + 1, n + 1} (h_{n + 1} f_{n + 1} + \ftd{n + 1})]^2 
\}}{(\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2} \\
+ \postmod{n} \adjfuncforward{n} \sum_{\ell = 0}^n \frac{\postmod{\ell} \ukmod{\ell} \{\bkmod{\ell}(\tstatmod{\ell} h_\ell + \addf{\ell} - \tstatmod{\ell + 1} h_{\ell + 1})^2 \ukmod{\ell + 1, n}(f_{n + 1}^2 \bkmod{n} \varphi_n)\}}{\K^{n - \ell + 1} (\postmod{\ell} \ukmod{\ell, n - 1} \1_{\Xset_n}) (\postmod{n} \ukmod{n} \1_{\Xset_{n + 1}})^2}, 
\end{multline*}
which indeed equals $\sigma^2_{n + 1} \langle (\varphi_\ell)_{\ell = 0}^n \rangle(h_{n + 1}, f_{n + 1}, \ftd{n + 1})$. Consequently, \eqref{eq:as:var:second:expression} can be expressed as 
\begin{multline*}
\sigma^2_{n + 1}(h_{n + 1}, f_{n + 1}, \ftd{n + 1}) = 
\frac{\chi \{ \initwgtfunc 
\retrokmodmodnorm_{0, n + 1}( h_{n + 1} f_{n + 1} + \ftd{n + 1}) \}^2}{(\chi \ukmod{0, n} \1_{\Xset^{n + 1}})^2} \\
+ \sigma^2_{n + 1} \langle (\wgtfuncmod{\ell})_{\ell = 0}^n \rangle(h_{n + 1}, f_{n + 1}, \ftd{n + 1}) + \sigma^2_{n + 1} \langle (\ukestvar{\ell})_{\ell = 0}^n \rangle(h_{n + 1}, f_{n + 1}, \ftd{n + 1}),  
\end{multline*}
which was to be established. 

Finally, it remains to check the base case $n = 1$. Indeed, since the initial particles are drawn independently from $\init$ (and $h_0 \equiv 0$, $\tstat{0} h_0 \equiv 0$, and $\eta_0 \equiv 0$), $\sigma^2_0(h_0, f_0, \ftd{0}) = \chi \{ \initwgtfunc (\ftd{0} - \chi \ftd{0}) \}^2 / (\chi \1_{\Xset_0})^2$ for all $(f_0, \ftd{0}) \in \bmf{\Xfd_0}^2$; thus, \eqref{eq:as:var:second:expression} provides, since $\chi \ukmod{0}(\addf{0} f_1 + \bar{f}_1) = 0$ and $\ukmod{0} (\addf{0} f_1 + \bar{f}_1) = \retrokmodmodnorm_{0, 1}(h_1 f_1 + \ftd{1})$,  
\begin{multline} 
\sigma^2_1(h_1, f_1, \ftd{1}) \eqdef \frac{\chi \{  \initwgtfunc \retrokmodmodnorm_{0, 1}(h_1 f_1 + \ftd{1}) \}^2}{(\chi \ukmod{0} \1_{\Xset_1})^2} + 
\frac{\post{0} \adjfuncforward{0} \post{0} \ukmod{0} \{\wgtfuncmod{0}(f_1 \tstatmod{1} h_1 + \bar{f}_1)^2 \}}{(\post{0} \ukmod{0} \1_{\Xset_1})^2} \\
+ \K^{-1} \frac{\post{0} \adjfuncforward{0} \post{0} \ukmod{0} \{\bkmod{0}(\addf{0} - \tstatmod{1} h_1)^2 f_1^2 \bkmod{0} \wgtfuncmod{0} \}}{(\post{0} \ukmod{0} \1_{\Xset_1})^2} 
+ \frac{\post{0} \adjfuncforward{0} \post{0} \ukmod{0} \{ \ukestvar{0} (f_1 \tstatmod{1} h_1 + \bar{f}_1)^2 \}}{(\post{0} \ukmod{0} \1_{\Xset_1})^2} \\
+ \K^{-1} \frac{\post{0} \adjfuncforward{0} \post{0} \ukmod{0} \{\bkmod{0}(\addf{0} - \tstatmod{1} h_1)^2 f_1^2 \bkmod{0} \ukestvar{0} \}}{(\post{0} \ukmod{0} \1_{\Xset_1})^2},  
\end{multline}
and by noting that $f_1 \tstatmod{1} h_1 + \bar{f}_1 = \retrokmodmodnorm_{1, 1} (h_1 f_1 + \ftd{1})$ we may conclude that the previous quantity coincides with \eqref{eq:non-recursive:as:var:affine} for $n = 1$. This completes the proof. 
\end{proof}

